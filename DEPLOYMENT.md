# Django CV Project - Render Deployment Guide

This Django project with Celery task processing is ready for deployment on Render.com.

## Project Overview

This is a Django application that processes PDF slides using Celery workers. It includes:
- Django web application
- Celery workers for background task processing
- Celery Beat for scheduled tasks
- Redis for message broker
- PostgreSQL database
- PDF processing with PyMuPDF

## Files Created for Deployment

### Core Deployment Files
- `Dockerfile` - Container configuration for the Django app
- `render.yaml` - Render.com service configuration
- `start.sh` - Application startup script
- `.dockerignore` - Docker build optimization

### Configuration Files
- `async_demo/settings_production.py` - Production Django settings
- `env.example` - Environment variables template
- `requirements.txt` - Updated with production dependencies

## Deployment Steps

### 1. Prepare Your Repository

1. Push all files to your Git repository
2. Ensure your repository is connected to Render

### 2. Deploy on Render

#### Option A: Using render.yaml (Recommended)
1. Connect your GitHub repository to Render
2. Render will automatically detect the `render.yaml` file
3. All services will be created automatically:
   - Web service (Django app)
   - PostgreSQL database
   - Redis service
   - Celery worker
   - Celery beat scheduler

#### Option B: Manual Service Creation
If you prefer manual setup:

1. **Create PostgreSQL Database**
   - Service type: PostgreSQL
   - Plan: Starter
   - Name: `django-cv-db`

2. **Create Redis Service**
   - Service type: Redis
   - Plan: Starter
   - Name: `django-cv-redis`

3. **Create Web Service**
   - Service type: Web Service
   - Environment: Docker
   - Dockerfile path: `./Dockerfile`
   - Plan: Starter
   - Environment variables:
     ```
     DJANGO_SECRET_KEY: [Generate new]
     DEBUG: False
     DJANGO_SETTINGS_MODULE: async_demo.settings_production
     DATABASE_URL: [From PostgreSQL service]
     CELERY_BROKER_URL: [From Redis service]
     CELERY_RESULT_BACKEND: [From Redis service]
     ```

4. **Create Celery Worker**
   - Service type: Background Worker
   - Environment: Docker
   - Dockerfile path: `./Dockerfile`
   - Start command: `celery -A async_demo worker -l info`
   - Same environment variables as web service

5. **Create Celery Beat**
   - Service type: Background Worker
   - Environment: Docker
   - Dockerfile path: `./Dockerfile`
   - Start command: `celery -A async_demo beat -l info`
   - Same environment variables as web service

### 3. Environment Variables

Required environment variables:
- `DJANGO_SECRET_KEY` - Django secret key (auto-generated by Render)
- `DEBUG` - Set to `False` for production
- `DJANGO_SETTINGS_MODULE` - Set to `async_demo.settings_production`
- `DATABASE_URL` - PostgreSQL connection string (provided by Render)
- `CELERY_BROKER_URL` - Redis connection string (provided by Render)
- `CELERY_RESULT_BACKEND` - Redis connection string (provided by Render)

### 4. Post-Deployment

After deployment:
1. Check that all services are running
2. Verify the web service is accessible
3. Monitor logs for any issues
4. Test PDF processing functionality

## Local Development

To run locally with Docker:

```bash
# Build and run with docker-compose
docker-compose up --build

# Or run individual services
docker build -t django-cv .
docker run -p 8000:8000 django-cv
```

## Features

- **PDF Processing**: Automatically processes PDF files in the `incoming_slides` directory
- **Background Tasks**: Uses Celery for asynchronous PDF processing
- **Scheduled Scanning**: Celery Beat scans for new PDFs every 2 minutes
- **Image Extraction**: Extracts images from PDF pages
- **Markdown Generation**: Converts PDF pages to Markdown with frontmatter

## Monitoring

- Web application logs are available in Render dashboard
- Celery worker logs show task processing status
- Use Flower (if enabled) for Celery monitoring

## Troubleshooting

### Common Issues

1. **Database Connection Errors**
   - Verify `DATABASE_URL` is correctly set
   - Check PostgreSQL service is running

2. **Redis Connection Errors**
   - Verify `CELERY_BROKER_URL` and `CELERY_RESULT_BACKEND` are set
   - Check Redis service is running

3. **Static Files Issues**
   - Ensure `collectstatic` runs during deployment
   - Check `STATIC_ROOT` and `STATIC_URL` settings

4. **PDF Processing Errors**
   - Verify PyMuPDF dependencies are installed
   - Check file permissions for slide directories

### Logs

Check logs in Render dashboard:
- Web service logs
- Worker service logs
- Database logs
- Redis logs

## Security Notes

- Production settings include security headers
- SSL/HTTPS is enforced
- Debug mode is disabled
- Secret key is auto-generated
- Database credentials are managed by Render

## Scaling

To scale the application:
1. Upgrade service plans in Render dashboard
2. Add more Celery workers if needed
3. Consider using Redis Cluster for high availability
4. Monitor resource usage and adjust accordingly
